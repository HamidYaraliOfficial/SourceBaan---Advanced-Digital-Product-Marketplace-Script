<?php
declare(strict_types=1);

header('Content-Type: application/json; charset=utf-8');

require_once __DIR__ . '/../includes/config.php';
require_once __DIR__ . '/../includes/utils.php';
require_once __DIR__ . '/../includes/db.php';

try {
    $method = strtoupper($_SERVER['REQUEST_METHOD'] ?? '');
    // lightweight router: GET for utility actions, POST for chat
    $action = (string)($_GET['action'] ?? '');
    if ($action === 'get_signed_download') {
        // Signed download links are disabled; require login and direct link
        $id = (int)($_GET['id'] ?? 0);
        if ($id <= 0) { echo json_encode(['ok' => false, 'error' => 'Ø´Ù†Ø§Ø³Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±']); exit; }
        echo json_encode(['ok' => true, 'url' => '../api/download.php?id=' . $id], JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES);
        exit;
    }
    if ($method !== 'POST') { echo json_encode(['ok' => false, 'error' => 'Ù…ØªØ¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª']); exit; }

    $raw = file_get_contents('php://input') ?: '';
    $payload = json_decode($raw, true);
    $q = '';
    if (is_array($payload)) { $q = trim((string)($payload['message'] ?? '')); }
    if ($q === '') { $q = trim((string)($_POST['message'] ?? '')); }
    if ($q === '') {
        echo json_encode(['ok' => false, 'error' => 'Ø³ÙˆØ§Ù„ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª']);
        exit;
    }

    // Lightweight per-IP throttle (sessionless)
    $rateFile = DATA_DIR . '/assistant_rate.json';
    $map = [];
    $rawRate = @file_get_contents($rateFile);
    if ($rawRate) { $tmp = json_decode($rawRate, true); if (is_array($tmp)) { $map = $tmp; } }
    $ip = $_SERVER['HTTP_CF_CONNECTING_IP'] ?? ($_SERVER['HTTP_X_FORWARDED_FOR'] ?? ($_SERVER['REMOTE_ADDR'] ?? '0.0.0.0'));
    $now = time();
    $entry = $map[$ip] ?? ['t' => 0, 'c' => 0];
    if (($now - (int)($entry['t'] ?? 0)) > 60) { $entry = ['t' => $now, 'c' => 0]; }
    $entry['c'] = (int)($entry['c'] ?? 0) + 1;
    $map[$ip] = $entry;
    if ((int)$entry['c'] > 20) { echo json_encode(['ok' => false, 'error' => 'Ø²ÛŒØ§Ø¯ÛŒ Ø³ÙˆØ§Ù„ Ù…ÛŒâ€ŒÙ¾Ø±Ø³ÛŒØ¯! Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.']); exit; }
    if (((int)$entry['c'] % 4) === 0) { @file_put_contents($rateFile, json_encode($map, JSON_UNESCAPED_UNICODE)); }

    // Maintain short session history (per user)
    if (!isset($_SESSION['assistant_history']) || !is_array($_SESSION['assistant_history'])) {
        $_SESSION['assistant_history'] = [];
    }
    $history = $_SESSION['assistant_history'];
    // Cap history to last 10 turns
    if (count($history) > 18) { $history = array_slice($history, -18); }

    [$answer, $meta] = generate_answer($q, $history);

    // Append to history
    $history[] = ['role' => 'user', 'text' => $q, 't' => time()];
    $history[] = ['role' => 'assistant', 'text' => $answer, 't' => time(), 'meta' => $meta];
    $_SESSION['assistant_history'] = $history;

    echo json_encode(['ok' => true, 'answer' => $answer, 'suggestions' => $meta['suggestions'] ?? [], 'results' => $meta['results'] ?? []], JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES);
    exit;

} catch (Throwable $e) {
    echo json_encode(['ok' => false, 'error' => 'Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±: ' . $e->getMessage()]);
}

function generate_answer(string $q, array $history = []): array {
    $ql = mb_strtolower($q, 'UTF-8');
    
    // Check if this is a suggested question first
    $suggestedQuestions = [
        'Ú†Ø·ÙˆØ± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†Ù…ØŸ' => 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…',
        'Ú†Ø·ÙˆØ± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†Ù…ØŸ' => 'Ø¢Ù¾Ù„ÙˆØ¯',
        'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú†Ø·ÙˆØ± Ø§Ø³ØªØŸ' => 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯',
        'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú†ÛŒØ³ØªØŸ' => 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯',
        'Ø¢Ù…Ø§Ø± Ø³Ø§ÛŒØª Ø±Ø§ Ø¨Ú¯Ùˆ' => 'Ø¢Ù…Ø§Ø±',
        'Ø§ÛŒÙ…ÛŒÙ„ Ù†Ù…ÛŒØ§Ø¯ØŒ Ú†Ú©Ø§Ø± Ú©Ù†Ù…ØŸ' => 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…',
        'Ú†Ø±Ø§ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ' => 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…',
        'Ú†Ù‡ ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø¬Ø§Ø² Ø§Ø³ØªØŸ' => 'Ø¢Ù¾Ù„ÙˆØ¯',
        'Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ' => 'Ø¢Ù¾Ù„ÙˆØ¯',
        'Ø¢ÛŒØ§ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø§Ø±Ø¯ØŸ' => 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯',
        'Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªÚ©â€ŒÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø±Ø¯ØŸ' => 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯',
        'Ú†Ú¯ÙˆÙ†Ù‡ CSRF Ø±Ø§ Ø±ÙØ¹ Ú©Ù†Ù…ØŸ' => 'csrf',
        'Ú†Ø±Ø§ ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ' => 'csrf',
        'ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ØŸ' => 'Ø¢Ù…Ø§Ø±',
        'Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø§Ø±ÛŒÙ…ØŸ' => 'Ø¢Ù…Ø§Ø±',
        'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø§ÛŒØª' => 'Ø±Ø§Ù‡Ù†Ù…Ø§',
        'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…' => 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…',
        'Ø¢Ù¾Ù„ÙˆØ¯ Ù¾Ø±ÙˆÚ˜Ù‡' => 'Ø¢Ù¾Ù„ÙˆØ¯',
        'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†' => 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯',
        'Ø¢Ù…Ø§Ø± Ø³Ø§ÛŒØª' => 'Ø¢Ù…Ø§Ø±'
    ];

    // If exact suggested question match, override the query
    if (isset($suggestedQuestions[$q])) {
        $ql = $suggestedQuestions[$q];
    }

    // Data-driven snippets
    $submissions = JsonDB::read('submissions');
    $approved = array_values(array_filter($submissions, fn($s) => ($s['status'] ?? 'pending') === 'approved'));
    $pending = array_values(array_filter($submissions, fn($s) => ($s['status'] ?? 'pending') === 'pending'));
    $users = JsonDB::read('users');
    $projectsCount = count($approved);
    $totalDownloads = array_sum(array_map(fn($p) => (int)($p['downloads'] ?? 0), $approved));
    $usersCount = count($users);
    $pendingCount = count($pending);

    // Enhanced Q&A with better keyword matching
    $faqs = [
        // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ ÙˆØ±ÙˆØ¯
        ['keys' => ['Ø«Ø¨Øª Ù†Ø§Ù…','Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…','register','Ú©Ø¯ ØªØ§ÛŒÛŒØ¯','Ø§ÛŒÙ…ÛŒÙ„ Ù†Ù…ÛŒØ§Ø¯','ØªØ§ÛŒÛŒØ¯ Ù†Ù…ÛŒØ§Ø¯','Ú©Ø¯ Ù†Ù…ÛŒØ§Ø¯'], 'a' => "ðŸ” **Ù†Ø­ÙˆÙ‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…:**\n1. ÙØ±Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯\n2. Â«Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯Â» Ø¨Ø²Ù†ÛŒØ¯\n3. Ú©Ø¯ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ù‡Ù…Ø§Ù† ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ù‚Ø§Ø¨Ù„ Ú©Ù¾ÛŒ)\n4. Ú©Ø¯ Ø±Ø§ Ø¯Ø± ÙÛŒÙ„Ø¯ ØªØ§ÛŒÛŒØ¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯\n\nðŸ’¡ **Ù†Ú©ØªÙ‡:** Ø§Ú¯Ø± Ø§ÛŒÙ…ÛŒÙ„ Ù‡Ù… Ø¨Ø±Ø³Ø¯ØŒ ÛŒÚ© Ù†Ø³Ø®Ù‡ Ø§Ø² Ú©Ø¯ Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯."],
        
        ['keys' => ['ÙˆØ±ÙˆØ¯','Ù„Ø§Ú¯ÛŒÙ†','login','Ø±Ù…Ø² ÙØ±Ø§Ù…ÙˆØ´','ÙØ±Ø§Ù…ÙˆØ´ÛŒ Ø±Ù…Ø²','Ù¾Ø³ÙˆØ±Ø¯'], 'a' => "ðŸ”‘ **Ù†Ø­ÙˆÙ‡ ÙˆØ±ÙˆØ¯:**\nâ€¢ Ø§Ø² Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ù†Ø§Ù…â€ŒÚ©Ø§Ø±Ø¨Ø±ÛŒ + Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯\nâ€¢ Ø§Ú¯Ø± Ø±Ù…Ø² Ø±Ø§ ÙØ±Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯ÛŒØ¯ØŒ Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ ÙØ¹Ù„Ø§Ù‹ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ù†Ø¯Ø§Ø±ÛŒÙ…\nâ€¢ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯\nâ€¢ ÛŒØ§ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø³Ø§ÛŒØª Ú©Ù…Ú© Ø¨Ú¯ÛŒØ±ÛŒØ¯"],
        
        // Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ù¾Ø±ÙˆÚ˜Ù‡
    ['keys' => ['Ø¢Ù¾Ù„ÙˆØ¯','Ø§Ø±Ø³Ø§Ù„ Ù¾Ø±ÙˆÚ˜Ù‡','upload','Ø³ÙˆØ±Ø³ Ø¢Ù¾Ù„ÙˆØ¯','Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø±Ø³Ø§Ù„','Ú†Ø·ÙˆØ± Ø¢Ù¾Ù„ÙˆØ¯'], 'a' => "ðŸ“¤ **Ù†Ø­ÙˆÙ‡ Ø¢Ù¾Ù„ÙˆØ¯ Ù¾Ø±ÙˆÚ˜Ù‡:**\n1. Ø¨Ù‡ ØµÙØ­Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ø±ÙˆÛŒØ¯\n2. ÙØ§ÛŒÙ„ ZIP Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (Ø­Ø¯Ø§Ú©Ø«Ø± 51200 Ú©ÛŒÙ„ÙˆØ¨Ø§ÛŒØª)\n3. Ø¹Ù†ÙˆØ§Ù†ØŒ ØªÙˆØ¶ÛŒØ­Ø§Øª Ùˆ Ø²Ø¨Ø§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯\n4. ØªØ§ 5 ØªØµÙˆÛŒØ± Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯\n5. Ø¯Ø±ØµØ¯ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯\n6. Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù…Ù†ØªØ´Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯"],
        
        ['keys' => ['Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯','Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†','viewer','ÙˆÛŒÙˆÙØ±','Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¯ÛŒØ¯Ù†'], 'a' => "ðŸ‘ï¸ **Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†:**\nâ€¢ Ø¯Ø± ØµÙØ­Ù‡ Ù‡Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ú©Ù…Ù‡ Â«Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯\nâ€¢ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø±Ø®ØªÛŒ Ø¨Ø¨ÛŒÙ†ÛŒØ¯\nâ€¢ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ú©Ø¯Ù‡Ø§ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª\nâ€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ ØªÚ©â€ŒÙØ§ÛŒÙ„ Ù‡Ù… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯\nâ€¢ Syntax highlighting Ø¨Ø±Ø§ÛŒ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù"],
        
        // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ø¬Ø³ØªØ¬Ùˆ
        ['keys' => ['Ù‡Ø´ØªÚ¯','hashtag','Ø³Ø¦Ùˆ','Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ','Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ','category','Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…'], 'a' => "ðŸ·ï¸ **Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ù‡Ø´ØªÚ¯:**\nâ€¢ Ù‡Ù†Ú¯Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ØŒ Ù‡Ø´ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯\nâ€¢ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯: Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø¹Ù…ÙˆÙ…ÛŒØŒ ÙˆØ¨ØŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ØŒ AIØŒ Ø§Ù…Ù†ÛŒØªØŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ØŒ DevOpsØŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ØŒ Ø³ÙˆØ§Ù„â€ŒÙˆØ¬ÙˆØ§Ø¨ØŒ Ú¯ÙØªÚ¯ÙˆÛŒ Ø¢Ø²Ø§Ø¯\nâ€¢ **Ø¬Ø¯ÛŒØ¯:** Ø¯Ø³ØªÙ‡ Â«Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…ÛŒÂ» Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡\nâ€¢ Ø§ÛŒÙ† Ú©Ø§Ø± SEO Ø³Ø§ÛŒØª Ùˆ Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯"],
        
        ['keys' => ['Ø¯Ø±ØµØ¯ Ø²Ø¨Ø§Ù†','python','javascript','php','java','c++','Ø²Ø¨Ø§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡'], 'a' => "ðŸ“Š **Ø¯Ø±ØµØ¯ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ:**\nâ€¢ Ø¯Ø± ÙØ±Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø±ØµØ¯ Ù‡Ø± Ø²Ø¨Ø§Ù† Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯\nâ€¢ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡: Python, JavaScript, PHP, Java, C++, Other\nâ€¢ Ù…Ø¬Ù…ÙˆØ¹ Ø¯Ø±ØµØ¯Ù‡Ø§ Ø¨Ø§ÛŒØ¯ Ú©Ù…ØªØ± ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒ 100 Ø¨Ø§Ø´Ø¯\nâ€¢ Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± ØµÙØ­Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯"],
        
        // Ù…Ø´Ú©Ù„Ø§Øª ÙÙ†ÛŒ
        ['keys' => ['csrf','ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø±','Ø®Ø·Ø§ Ø§Ø¯Ù…ÛŒÙ†','ØªØ§ÛŒÛŒØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø®Ø·Ø§'], 'a' => "ðŸ”§ **Ø±ÙØ¹ Ø®Ø·Ø§ÛŒ CSRF:**\nâ€¢ Ø¯Ø± Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø§Ú¯Ø± Â«ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø±Â» Ø¯ÛŒØ¯ÛŒØ¯ØŒ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯\nâ€¢ ØªÙˆÚ©Ù† CSRF Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯\nâ€¢ Ø§ÛŒÙ† Ø®Ø·Ø§ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø±Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯"],
        
    ['keys' => ['Ø®Ø·Ø§ Ø¢Ù¾Ù„ÙˆØ¯','Ø¢Ù¾Ù„ÙˆØ¯ Ù†Ù…ÛŒØ´Ù‡','ÙØ§ÛŒÙ„ Ø¢Ù¾Ù„ÙˆØ¯ Ù†Ø´Ø¯','error upload'], 'a' => "âŒ **Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Ø¢Ù¾Ù„ÙˆØ¯:**\nâ€¢ Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ú©Ù…ØªØ± Ø§Ø² 51200 Ú©ÛŒÙ„ÙˆØ¨Ø§ÛŒØª Ø¨Ø§Ø´Ø¯\nâ€¢ ÙØ±Ù…Øª ZIP ÛŒØ§ RAR Ø¨Ø§Ø´Ø¯\nâ€¢ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù¾Ø± Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯\nâ€¢ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ù¾Ø§ÛŒØ¯Ø§Ø± Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯\nâ€¢ Ø§Ú¯Ø± Ø¨Ø§Ø²Ù‡Ù… Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ Ø¹ÙˆØ¶ Ú©Ù†ÛŒØ¯"],
        
        // Ø¢Ù…Ø§Ø± Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§ÛŒØª
        ['keys' => ['Ú†Ù†Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡','ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡','Ø¢Ù…Ø§Ø± Ù¾Ø±ÙˆÚ˜Ù‡','Ù¾Ø±ÙˆÚ˜Ù‡ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡'], 'a' => "ðŸ“ˆ **Ø¢Ù…Ø§Ø± Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§:**\nâ€¢ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡: {$projectsCount} Ø¹Ø¯Ø¯\nâ€¢ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±: {$pendingCount} Ø¹Ø¯Ø¯\nâ€¢ Ù…Ø¬Ù…ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯Ù‡Ø§: {$totalDownloads} Ø¨Ø§Ø±\nâ€¢ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: {$usersCount} Ù†ÙØ±"],
        
        ['keys' => ['Ø¯Ø§Ù†Ù„ÙˆØ¯','Ú†Ù†Ø¯ Ø¨Ø§Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯','Ø¢Ù…Ø§Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯'], 'a' => "ðŸ“¥ **Ø¢Ù…Ø§Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯:**\nâ€¢ Ù…Ø¬Ù…ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯Ù‡Ø§: {$totalDownloads} Ø¨Ø§Ø±\nâ€¢ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ø± Ù¾Ø±ÙˆÚ˜Ù‡ØŒ Ø§Ø¨ØªØ¯Ø§ Ø¢Ù† Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯\nâ€¢ Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø± ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯\nâ€¢ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´ÙˆÛŒØ¯"],
        
        ['keys' => ['Ú©Ø§Ø±Ø¨Ø±Ø§Ù†','Ø§Ø¹Ø¶Ø§','Ú†Ù†Ø¯ Ù†ÙØ±','ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±'], 'a' => "ðŸ‘¥ **Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:**\nâ€¢ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø§Ø¹Ø¶Ø§: {$usersCount} Ù†ÙØ±\nâ€¢ Ø¨Ø±Ø§ÛŒ Ø¹Ø¶ÙˆÛŒØª ÙÙ‚Ø· Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ú©Ø§ÙÛŒ Ø§Ø³Øª\nâ€¢ Ø§Ù…Ú©Ø§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ø¢ÙˆØ§ØªØ§Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯\nâ€¢ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª"],
        
        // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ
        ['keys' => ['Ø±Ø§Ù‡Ù†Ù…Ø§','help','Ú©Ù…Ú©','Ú†Ø·ÙˆØ±','Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡'], 'a' => "â„¹ï¸ **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø§ÛŒØª:**\nâ€¢ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…: auth.php\nâ€¢ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯: upload.php\nâ€¢ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§: sources.php\nâ€¢ Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¬Ù…Ù†: forum.php\nâ€¢ Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÙØ§ÛŒÙ„: profile.php?user=Ù†Ø§Ù…â€ŒÚ©Ø§Ø±Ø¨Ø±ÛŒ\nâ€¢ Ø¯Ø³ØªÛŒØ§Ø± (Ù‡Ù…ÛŒÙ† Ú†Øª): Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª"],
        
        ['keys' => ['Ø§Ù†Ø¬Ù…Ù†','forum','Ø¨Ø­Ø«','Ú¯ÙØªÚ¯Ùˆ','Ø³ÙˆØ§Ù„'], 'a' => "ðŸ’¬ **Ø§Ù†Ø¬Ù…Ù† Ø³Ø§ÛŒØª:**\nâ€¢ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù: Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒØŒ ÙˆØ¨ØŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ØŒ AI Ùˆ...\nâ€¢ Ø§Ù…Ú©Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÛŒØ¯\nâ€¢ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ø¯ÛŒÚ¯Ø±Ø§Ù†\nâ€¢ Ø³ÛŒØ³ØªÙ… Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ\nâ€¢ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØªÙˆØ§ Ùˆ ÙÛŒÙ„ØªØ± Ú©Ù„Ù…Ø§Øª Ù†Ø§Ù…Ù†Ø§Ø³Ø¨"],
    ];

    // Ø¨Ù‡ØªØ± Ú©Ø±Ø¯Ù† ØªØ·Ø¨ÛŒÙ‚ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ
    $bestMatch = '';
    $maxScore = 0;
    
    foreach ($faqs as $f) {
        $score = 0;
        foreach ($f['keys'] as $k) {
            if (mb_strpos($ql, $k) !== false) {
                $score += mb_strlen($k); // Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ± = Ø§Ù…ØªÛŒØ§Ø² Ø¨ÛŒØ´ØªØ±
            }
        }
        if ($score > $maxScore) {
            $maxScore = $score;
            $bestMatch = $f['a'];
        }
    }
    
    if ($maxScore > 0) {
        return [$bestMatch, ['matched' => true, 'suggestions' => suggest_followups($ql)]];
    }

    // Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ
    if (mb_strpos($ql, 'Ø³Ù„Ø§Ù…') !== false || mb_strpos($ql, 'Ø¯Ø±ÙˆØ¯') !== false) {
        return [
            "ðŸ‘‹ Ø³Ù„Ø§Ù… Ùˆ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø¨Ù‡ Ø³ÙˆØ±Ø³ Ú©Ø¯Ù‡!\n\nÙ…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ø§ÛŒØª Ù‡Ø³ØªÙ…. Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø± Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ú©Ù…Ú©ØªØ§Ù† Ú©Ù†Ù…:\nâ€¢ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ ÙˆØ±ÙˆØ¯\nâ€¢ Ø¢Ù¾Ù„ÙˆØ¯ Ù¾Ø±ÙˆÚ˜Ù‡\nâ€¢ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†\nâ€¢ Ø¢Ù…Ø§Ø± Ø³Ø§ÛŒØª\nâ€¢ Ø±ÙØ¹ Ù…Ø´Ú©Ù„Ø§Øª ÙÙ†ÛŒ\n\nØ³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø·Ø±Ø­ Ú©Ù†ÛŒØ¯ ØªØ§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒâ€ŒØªØ§Ù† Ú©Ù†Ù…! ðŸ˜Š",
            ['suggestions' => ['Ú†Ø·ÙˆØ± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†Ù…ØŸ','Ú†Ø·ÙˆØ± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†Ù…ØŸ','Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú†Ø·ÙˆØ± Ø§Ø³ØªØŸ','Ø¢Ù…Ø§Ø± Ø³Ø§ÛŒØª Ø±Ø§ Ø¨Ú¯Ùˆ']] 
        ];
    }
    
    if (mb_strpos($ql, 'Ù…Ù…Ù†ÙˆÙ†') !== false || mb_strpos($ql, 'Ù…ØªØ´Ú©Ø±') !== false || mb_strpos($ql, 'Ù…Ø±Ø³ÛŒ') !== false) {
        return ["ðŸ˜Š Ø®ÙˆØ§Ù‡Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù…! Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ ØªÙˆÙ†Ø³ØªÙ… Ú©Ù…Ú©ØªØ§Ù† Ú©Ù†Ù….\n\nØ§Ú¯Ø± Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¯Ø§Ø´ØªÛŒØ¯ØŒ Ø¯Ø± Ø®Ø¯Ù…ØªÙ…. Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´ÛŒØ¯! ðŸš€", ['suggestions' => ['Ø¢Ù¾Ù„ÙˆØ¯ Ù¾Ø±ÙˆÚ˜Ù‡','Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†','Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø§ÛŒØª']]];
    }

    // Ø³ÙˆØ§Ù„Ø§Øª Ù…Ø¨Ù‡Ù…
    if (mb_strlen($ql) < 3) {
        return ["ðŸ¤” Ø³ÙˆØ§Ù„ Ø´Ù…Ø§ Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø³ÙˆØ§Ù„ Ú©Ø§Ù…Ù„ØªØ±ÛŒ Ø¨Ù¾Ø±Ø³ÛŒØ¯ ØªØ§ Ø¨ØªÙˆØ§Ù†Ù… Ø¨Ù‡ØªØ± Ú©Ù…Ú©ØªØ§Ù† Ú©Ù†Ù….", ['suggestions' => ['Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú†Ú¯ÙˆÙ†Ù‡ Ø§Ø³ØªØŸ','Ú†Ø·ÙˆØ± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†Ù…ØŸ','Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú†ÛŒØ³ØªØŸ']]];
    }

    // Generic fallback Ø¨Ø§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¨Ù‡ØªØ±
    return [
        "ðŸ¤– **Ù…ØªÙˆØ¬Ù‡ Ø³ÙˆØ§Ù„ Ø´Ù…Ø§ Ù†Ø´Ø¯Ù…!**\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø² Ø§ÛŒÙ† Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:\nâ€¢ 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…' - Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¹Ø¶ÙˆÛŒØª\nâ€¢ 'Ø¢Ù¾Ù„ÙˆØ¯' - Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø±ÙˆÚ˜Ù‡\nâ€¢ 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯' - Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¢Ù†Ù„Ø§ÛŒÙ†\nâ€¢ 'Ø¢Ù…Ø§Ø±' - Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§ÛŒØª\nâ€¢ 'Ø±Ø§Ù‡Ù†Ù…Ø§' - Ø¨Ø±Ø§ÛŒ Ú©Ù…Ú© Ø¹Ù…ÙˆÙ…ÛŒ\n\nÛŒØ§ Ø³ÙˆØ§Ù„ Ù…Ø´Ø®Øµâ€ŒØªØ±ÛŒ Ø¨Ù¾Ø±Ø³ÛŒØ¯ ðŸ˜Š",
        ['suggestions' => ['Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…','Ø¢Ù¾Ù„ÙˆØ¯ Ù¾Ø±ÙˆÚ˜Ù‡','Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†','Ø¢Ù…Ø§Ø± Ø³Ø§ÛŒØª']]
    ];
}

function suggest_followups(string $ql): array {
    $map = [
        'Ø«Ø¨Øª Ù†Ø§Ù…' => ['Ø§ÛŒÙ…ÛŒÙ„ Ù†Ù…ÛŒØ§Ø¯ØŒ Ú†Ú©Ø§Ø± Ú©Ù†Ù…ØŸ','Ú†Ø±Ø§ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ'],
        'Ø¢Ù¾Ù„ÙˆØ¯' => ['Ú†Ù‡ ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø¬Ø§Ø² Ø§Ø³ØªØŸ','Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ'],
        'Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†' => ['Ø¢ÛŒØ§ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø§Ø±Ø¯ØŸ','Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªÚ©â€ŒÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø±Ø¯ØŸ'],
        'cs' => ['Ú†Ú¯ÙˆÙ†Ù‡ CSRF Ø±Ø§ Ø±ÙØ¹ Ú©Ù†Ù…ØŸ','Ú†Ø±Ø§ ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ'],
        'Ø¢Ù…Ø§Ø±' => ['ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ØŸ','Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø§Ø±ÛŒÙ…ØŸ'],
    ];
    $out = [];
    foreach ($map as $k => $arr) {
        if (mb_strpos($ql, $k) !== false) { $out = array_merge($out, $arr); }
    }
    if (empty($out)) { $out = ['Ú†Ø·ÙˆØ± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†Ù…ØŸ','Ú†Ø·ÙˆØ± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†Ù…ØŸ','Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú†ÛŒØ³ØªØŸ']; }
    return $out;
}

?>


